{"version":3,"sources":["administracion/core.cljs"],"mappings":";AAOA,GAAA,QAAAA,2CAAAC,gDAAAC;AAAA;AAAA,AAAA,AAASC,uCAAW,gDAAA,hDAACC;;AACrB,GAAA,QAAAJ,2CAAAC,gDAAAI;AAAA;AAAA,AAAA,AAASC,qCAAS,gDAAA,hDAACF;;AACnB,GAAA,QAAAJ,2CAAAC,gDAAAM;AAAA;AAAA,AAAA,AAASC,8BAAQ,gDAAA,hDAACJ;;AAClB,GAAA,QAAAJ,2CAAAC,gDAAAQ;AAAA;AAAA,AAAA,AAASC,kCAAY,gDAAA,hDAACN;;AACtB,GAAA,QAAAJ,2CAAAC,gDAAAU;AAAA;AAAA,AAAA,AAASC,oCAAc,gDAAA,2CAAA,yDAAA,KAAA,oDAAA,7MAACR;;AACxB,GAAA,QAAAJ,2CAAAC,gDAAAY;AAAA;AAAA,AAAA,AAASC,iCAAW,gDAAA,hDAACV;;AACrB,GAAA,QAAAJ,2CAAAC,gDAAAc;AAAA;AAAA,AAAA,AAASC,+CAAmB,gDAAA,hDAACZ;;AAC7B,GAAA,QAAAJ,2CAAAC,gDAAAgB;AAAA;AAAA,AAAA,AAASC,gDAAoB,gDAAA,hDAACd;;AAE9B,GAAA,QAAAJ,2CAAAC,gDAAAkB;AAAA;AAAA,AAAA,AAASC,yCAAmB,gDAAA,hDAAChB;;AAC7B,GAAA,QAAAJ,2CAAAC,gDAAAoB;AAAA;AAAA,AAAA,AAASC,wCAAkB,gDAAA,hDAAClB;;AAE5B,qCAAA,rCAAMmB;AAAN,AACE,IAAMC,qBAAmB,qBAAA,rBAAUC;IAC7BC,iBAAe,qBAAA,rBAAUD;IACzBE,mBAAiB,qBAAA,rBAAUF;AAFjC,AAGE,oBAAM,iBAAAG,oBAAKJ;AAAL,AAAA,oBAAAI;AAAA,IAAAA,wBAAwBF;AAAxB,AAAA,oBAAAE;AAAuCD;;AAAvCC;;;AAAAA;;;AAAN,AACE,AAACC,sBAAOrB,4BAAQgB;;AAChB,AAACK,sBAAOf,+BAAWa;;AACnB,2DAAA,3DAACE,sBAAO1B;;AACR,wDAAA,2CAAA,4EAAA,/KAAC0B,sBAAOjB,sIAAuBY,uEAAwBE;;AAJzD;;AAAA;;;AAOJ,wCAAA,xCAAMI;AAAN,AACE,IAAMG,QAAM,0BAAA,AAAAF,1BAACG,0CAA2Bd;IAClCe,uBAAqB,+CAAA,WAAAC,1DAACC;AAAD,AAAS,OAACC,+BACA,AAACJ,0BAA0B,AAAA,uFAAAE,mBAC3BH;GAFV,AAAAF,gBAGSQ;AAJpC,AAAA,0FAAA,gEAAA,mFAAA,iDAAA,8BAAA,mFAAA,2FAAA,2CAAA,qDAAA,OAAA,mEAAA,sCAAA,sDAAA,AAAAR,wDAAA,+DAAA,WAAAC,lHAWaZ;AAXb,AAYiB,OAACS,sBAAOT,uCAAmB,AAAA,AAAAY;mBAZ5C,mFAAA,uDAAA,2CAAA,wDAAA,8BAAA,mFAAA,uDAAA,mFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,aAAA,aAAA,mFAAA,iDAAA,iBAAA,mFAAA,gGAAA,sBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,iBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mCAAA,mFAAA,sDAkBK,iBAAAQ,qBAAA,8DAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAE,qBAAA,AAAAC,cAAAH;AAAA,AAAA,GAAAE;AAAA,AAAA,IAAAF,eAAAE;AAAA,AAAA,GAAA,AAAAE,6BAAAJ;AAAA,IAAAK,kBAo6E4C,AAAA4D,sBAAAjE;IAp6E5CM,qBAAA,AAAAC,gBAAAF;IAAAG,WAAA,AAAAC,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAI,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAJ;AAAA,IAAAK,aAAA,AAAAC,eAAAP,gBAAAK;IAAAC,iBAAA,AAAAE,4BAAAF;SAAA,AAAAG,4CAAAH,eAAA,hEAAca;aAAd,AAAAV,4CAAAH,eAAA,pEAAiBc;kBAAjB,AAAAX,4CAAAH,eAAA,zEAAwBe;AAAxB,AAAA,AAAA,AAAAX,uBAAAP,SAAA,oBAAA,mFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,8BAAA,mFAAA,gEAAA,mFAAA,oHAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,2CAAA,6DAAA,n1BAG4BgB,+IAASC,kMAAoCC;;AAHzE,AAMiB,QAAM,AAAQC,gBAAa,CAAA,iEAA0BH;;SANtE,yBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,mCAAA,2CAAA,oDACSA;;AADT,eAAA,CAAAd,WAAA;;;;AAAA;;;;;AAAA,OAAAM,qBAAA,AAAAC,gBAAAT,UAAA,AAAAU,oDAAA,AAAAC,qBAAAnB;;AAAA,OAAAgB,qBAAA,AAAAC,gBAAAT,UAAA;;;AAAA,IAAAY,aAAA,AAAAC,gBAAArB;IAAAoB,iBAAA,AAAAP,4BAAAO;SAAA,AAAAN,4CAAAM,eAAA,hEAAcI;aAAd,AAAAV,4CAAAM,eAAA,pEAAiBK;kBAAjB,AAAAX,4CAAAM,eAAA,zEAAwBM;AAAxB,AAAA,OAAAJ,eAAA,oBAAA,mFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,8BAAA,mFAAA,gEAAA,mFAAA,oHAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,2CAAA,6DAAA,n1BAG4BE,+IAASC,kMAAoCC;;AAHzE,AAMiB,QAAM,AAAQC,gBAAa,CAAA,iEAA0BH;;SANtE,yBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,mCAAA,2CAAA,gEAAA,AAAAN,oDAAA,AAAAK,eAAAvB,/EACSwB;;;AADT;;;;GAAA,KAAA;;AAAA,AAAA,OAAAzB,mBAAsCL;KAlB3C,mFAAA,kDAAA,mFAAA,iDAAA,mFAAA,yDAAA,2CAAA,wDAAA,gBAAA;;AAgCF,uCAAA,vCAAMkC;AAAN,AACE,IAAMpC,QAAM,0BAAA,AAAAF,1BAACG,0CAA2BZ;IAClCiD,sBAAoB,+CAAA,WAAAC,1DAACnC;AAAD,AAAS,OAACC,+BACA,AAACJ,0BAA0B,AAAA,uFAAAsC,mBAC3BvC;GAFV,AAAAF,gBAGS0C;AAJnC,AAAA,0FAAA,gEAAA,mFAAA,iDAAA,6BAAA,mFAAA,2FAAA,2CAAA,qDAAA,OAAA,mEAAA,gCAAA,sDAAA,AAAA1C,uDAAA,+DAAA,WAAAuC,jHAUahD;AAVb,AAWiB,OAACO,sBAAOP,sCAAkB,AAAA,AAAAgD;mBAX3C,mFAAA,uDAAA,2CAAA,wDAAA,8BAAA,mFAAA,uDAAA,oFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,aAAA,aAAA,mFAAA,iDAAA,iBAAA,mFAAA,8FAAA,sBAAA,mFAAA,gGAAA,iBAAA,mFAAA,8FAAA,yBAAA,mFAAA,8FAAA,wBAAA,mFAAA,iDAAA,+BAAA,mFAAA,iDAAA,iBAAA,mFAAA,iDAAA,mCAAA,mFAAA,sDAmBK,iBAAA9B,qBAAA,6DAAAkC;AAAA,AAAA,YAAAhC,kBAAA,KAAA;AAAA,AAAA,IAAAgC,eAAAA;;AAAA,AAAA,IAAA/B,qBAAA,AAAAC,cAAA8B;AAAA,AAAA,GAAA/B;AAAA,AAAA,IAAA+B,eAAA/B;AAAA,AAAA,GAAA,AAAAE,6BAAA6B;AAAA,IAAA5B,kBAk4E4C,AAAA4D,sBAAAhC;IAl4E5C3B,qBAAA,AAAAC,gBAAAF;IAAA6B,WAAA,AAAAzB,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAA6B,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAA7B;AAAA,IAAA8B,aAAA,AAAAxB,eAAAP,gBAAA8B;IAAAC,iBAAA,AAAAvB,4BAAAuB;SAAA,AAAAtB,4CAAAsB,eAAA,hEAAcZ;aAAd,AAAAV,4CAAAsB,eAAA,pEAAiBX;kBAAjB,AAAAX,4CAAAsB,eAAA,zEAAwBG;aAAxB,AAAAzB,4CAAAsB,eAAA,pEAAoCI;uBAApC,AAAA1B,4CAAAsB,eAAA,9EAA2CK;iBAA3C,AAAA3B,4CAAAsB,eAAA,xEAA4DM;mBAA5D,AAAA5B,4CAAAsB,eAAA,1EAAuEO;AAAvE,AAAA,AAAA,AAAA5B,uBAAAmB,SAAA,oBAAA,oFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,wBAAA,mFAAA,gEAAA,mFAAA,mHAAA,mFAAA,iLAAA,mFAAA,wHAAA,mFAAA,kHAAA,mFAAA,sEAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,2CAAA,6DAAA,/nDAGsBV,+IAASC,iMAAoCc,uMAAyC,qDAAA,RAAKC,sNAClFC,2MAA8CC,uJAAiBC;;AAJ9F,AAOiB,QAAM,AAAQhB,gBAAa,CAAA,gEAAyBH;;SAPrE,yBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,mCAAA,2CAAA,oDACSA;;AADT,eAAA,CAAAW,WAAA;;;;AAAA;;;;;AAAA,OAAAnB,qBAAA,AAAAC,gBAAAiB,UAAA,AAAAG,mDAAA,AAAAlB,qBAAAc;;AAAA,OAAAjB,qBAAA,AAAAC,gBAAAiB,UAAA;;;AAAA,IAAAI,aAAA,AAAAjB,gBAAAY;IAAAK,iBAAA,AAAAzB,4BAAAyB;SAAA,AAAAxB,4CAAAwB,eAAA,hEAAcd;aAAd,AAAAV,4CAAAwB,eAAA,pEAAiBb;kBAAjB,AAAAX,4CAAAwB,eAAA,zEAAwBC;aAAxB,AAAAzB,4CAAAwB,eAAA,pEAAoCE;uBAApC,AAAA1B,4CAAAwB,eAAA,9EAA2CG;iBAA3C,AAAA3B,4CAAAwB,eAAA,xEAA4DI;mBAA5D,AAAA5B,4CAAAwB,eAAA,1EAAuEK;AAAvE,AAAA,OAAArB,eAAA,oBAAA,oFAAA,kDAAA,mFAAA,iDAAA,2CAAA,wDAAA,wBAAA,mFAAA,gEAAA,mFAAA,mHAAA,mFAAA,iLAAA,mFAAA,wHAAA,mFAAA,kHAAA,mFAAA,sEAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,2CAAA,6DAAA,/nDAGsBE,+IAASC,iMAAoCc,uMAAyC,qDAAA,RAAKC,sNAClFC,2MAA8CC,uJAAiBC;;AAJ9F,AAOiB,QAAM,AAAQhB,gBAAa,CAAA,gEAAyBH;;SAPrE,yBAAA,mFAAA,iDAAA,2CAAA,wDAAA,mBAAA,mFAAA,yDAAA,mCAAA,2CAAA,gEAAA,AAAAa,mDAAA,AAAAd,eAAAU,9EACST;;;AADT;;;;GAAA,KAAA;;AAAA,AAAA,OAAAzB,mBAAsF+B;KAnB3F,mFAAA,kDAAA,mFAAA,iDAAA,mFAAA,yDAAA,2CAAA,wDAAA,gBAAA;;AAkCF,4BAAA,5BAAMc;AAAN,AACE,2DAAA,qEAAA,2CAAA,wDAAA,2CAAA,yDAAA,AAAAtD,6CAAA,mEAAA,AAAAA,yDAAA,0DAAA,qDAAA,2EAAA,qDAAA,8DAAA,KAAA,2DAAA,WAAAuD,j2BAACE,gVACoBhF,gHACKE;AAF1B,AAMa,AACE,IAAA+E,aAAAH;IAAAG,iBAAA,AAAAnC,4BAAAmC;aAAA,AAAAlC,4CAAAkC,eAAA,pEAAcvB;UAAd,AAAAX,4CAAAkC,eAAA,jEAAqBC;YAArB,AAAAnC,4CAAAkC,eAAA,nEAAyBE;AAAzB,AAEE,wBAAA,xBAAalE;;AACb,wBAAA,xBAAaA;;AACb,wBAAA,xBAAaA;;AAEb,qBAAA,rBAAUA,+BAA0ByC;;AACpC,qBAAA,rBAAUzC,2BAAsBiE;;AAChC,qBAAA,rBAAUjE,6BAAwBkE;;AAElC,AAAC9D,sBAAOf,+BAAW6E;;AACnB,2DAAA,3DAAC9D,sBAAO1B;;AACR,+DAAA,2CAAA,gEAAA,nKAAC0B,sBAAOjB,sIAAuBsD,2DAAYwB;GAnB5D,uEAAA,WAAAH;AAAA,AAoBmB,AACE,yGAAA,0BAAAA,nIAACK;;AACD,MAAA,NAACC;;AACD,gEAAA,zDAAChE,sBAAOvB;;;AAE/B,iCAAA,jCAAM0F;AAAN,AAAA,0FAAA,0DAAA,2CAAA,wDAAA,yBAAA,mFAAA,mDAAA,2CAAA,wDAAA,kBAAA,mFAAA,gEAAA,mFAAA,8CAAA,sBAAA,mFAAA,sDAAA,2CAAA,qDAAA,OAAA,mEAAA,+BAAA,sDAAA,AAAAjE,6CAAA,+DAAA,WAAA+D,vGAOuBtF;AAPvB,AAQ2B,OAACqB,sBAAOrB,4BAAQ,AAAA,AAAAsF;2BAR3C,mFAAA,8CAAA,oBAAA,mFAAA,sDAAA,2CAAA,qDAAA,WAAA,mEAAA,6BAAA,sDAAA,AAAA/D,iDAAA,+DAAA,WAAAgE,3GAYuBrF;AAZvB,AAa2B,OAACmB,sBAAOnB,gCAAY,AAAA,AAAAqF;mCAb/C,mFAAA,0DAAA,2CAAA,wDAAA,oBAAA,mFAAA,gEAAA,mFAAA,yDAAA,2CAAA,+FAAA,lCAgB0BV;;AAE1B,6BAAA,7BAAMY;AAAN,AACE,2DAAA,3DAACpE,sBAAO1B;;AACR,qDAAA,rDAAC0B,sBAAOf;;AACR,wDAAA,2CAAA,yDAAA,KAAA,oDAAA,rNAACe,sBAAOjB;;AACR,wBAAA,xBAAaa;;AACb,wBAAA,xBAAaA;;AACb,+BAAA,xBAAaA;;AAGf,kCAAA,lCAAMyE;AAAN,AACE,AAACC;;AACD,AAACC;;AAFH,0FAAA,0DAAA,2CAAA,wDAAA,gBAAA,mFAAA,gEAAA,2CAAA,wDAAA,uBAAA,mFAAA,+QAAA,mFAAA,kQAAA,mFAAA,8CAAA,yDAAA,mFAAA,yDAAA,2CAAA,6DAAA,j+BAKS,CAAA,uMAAA,5IAAoB,AAAA,uFAAA,AAAArE,gBAAUnB,4LAC/B,CAAA,0DAAmB,AAAA,kFAAA,AAAAmB,gBAAOnB;AANlC,AAQyB,AACE,AAACqF;;AACD,uBAAA,hBAAS7B;WAVpC,6BAYI,+LAAA,AAAA,mFAAA,mDAAA,2CAAA,wDAAA,uBAAA,mFAAA,8CAAA,0DAAA,mFAAA,yDAAA,2CAAA,6DAAA,52BAAM,mLAAA,nLAACiC,6CAAE,AAAA,kFAAA,AAAAtE,gBAAOnB;AAAhB,AAGwB,AACE,mEAAA,nEAACiB,sBAAOb;;AACR,oEAAA,pEAACa,sBAAOX;;AACR,OAACiF;WAN3B,4BAAA,mFAAA,yDAAA,2CAAA,6DAAA;AAAA,AAOwB,AACE,oEAAA,pEAACtE,sBAAOX;;AACR,mEAAA,nEAACW,sBAAOb;;AACR,OAACoF;WAV3B,6BAAA,mFAAA,yDAAA,2CAAA,6DAAA;AAAA,AAWwB,AACE,oEAAA,pEAACvE,sBAAOX;;AACR,mEAAA,nEAACW,sBAAOb;;AACR,OAACoF;WAd3B,sCAAA,cAeD,kBAAA,AAAArE,+DAAA,AAAA,gIAAA,/KAAOf,kIACJqD,mDACH,kBAAA,AAAAtC,gEAAA,AAAA,iIAAA,jLAAOb,mIACJY;;AAEN,2BAAA,3BAAMwE;AAAN,AACE,oBAAA,AAAAvE,gBAAK5B;AAAL,0FACG+F;;AADH,0FAEGF;;;AAGL,2BAAA,3BAAMO;AAAN,AACE,AAAChF;;AACD,wDAAA,jDAACiF,oIAAYF,iCAAM,wBAAA,xBAAiBG;;AAGtC,AAACF","names":["js/administracion","js/administracion.core","js/administracion.core.logged-in?","administracion.core/logged-in?","reagent.core.atom","js/administracion.core.loading?","administracion.core/loading?","js/administracion.core.usuario","administracion.core/usuario","js/administracion.core.contrasenia","administracion.core/contrasenia","js/administracion.core.datos-usuario","administracion.core/datos-usuario","js/administracion.core.auth-token","administracion.core/auth-token","js/administracion.core.mostrar-productos?","administracion.core/mostrar-productos?","js/administracion.core.mostrar-categorias?","administracion.core/mostrar-categorias?","js/administracion.core.categoria-busqueda","administracion.core/categoria-busqueda","js/administracion.core.producto-busqueda","administracion.core/producto-busqueda","administracion.core/revisar-sesion","usuario-almacenado","js/localStorage","rol-almacenado","token-almacenado","and__5000__auto__","cljs.core/reset!","administracion.core/render-categorias","cljs.core/deref","p1__13921#","texto","clojure.string/lower-case","categorias-filtradas","p1__13920#","cljs.core.filter","clojure.string/includes?","app.db/categorias","iter__5480__auto__","s__13923","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5478__auto__","size__5479__auto__","cljs.core/count","b__13925","cljs.core/chunk-buffer","i__13924","map__13926","cljs.core/-nth","cljs.core/--destructure-map","cljs.core.get","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__13922","cljs.core/chunk-rest","map__13927","cljs.core/first","cljs.core/cons","cljs.core/rest","id","nombre","descripcion","js/location","administracion.core/render-productos","p1__13929#","productos-filtradas","p1__13928#","app.db/list-productos","s__13931","b__13933","i__13932","map__13934","iter__13930","map__13935","description","precio","nombre_categoria","tipo_plato","tipo_porcion","administracion.core/login","p1__13936#","p1__13937#","ajax.core.POST","map__13938","rol","token","cljs.core.println","js/alert","p1__13939#","p1__13940#","administracion.core/login-form","administracion.core/logout","administracion.core/admin-panel","app.db/fetch-list-productos","app.db/fetch-list-categorias","cljs.core._EQ_","administracion.core/page","administracion.core/init","reagent.dom.render","js/document","cljs.core/chunk-first"],"sourcesContent":["(ns administracion.core\r\n  (:require [reagent.core :as r]\r\n            [ajax.core :refer [POST]]\r\n            [app.db :refer [list-productos fetch-list-productos categorias fetch-list-categorias]]\r\n            [reagent.dom :as dom]\r\n            [reitit.frontend.easy :as rfe]))\r\n\r\n(defonce logged-in? (r/atom false))\r\n(defonce loading? (r/atom false))\r\n(defonce usuario (r/atom \"\"))\r\n(defonce contrasenia (r/atom \"\"))\r\n(defonce datos-usuario (r/atom {:nombre nil :rol nil}))\r\n(defonce auth-token (r/atom nil))\r\n(defonce mostrar-productos? (r/atom false))\r\n(defonce mostrar-categorias? (r/atom false))\r\n\r\n(defonce categoria-busqueda (r/atom \"\"))\r\n(defonce producto-busqueda (r/atom \"\"))\r\n\r\n(defn revisar-sesion []\r\n  (let [usuario-almacenado (.getItem js/localStorage \"usuario\")\r\n        rol-almacenado (.getItem js/localStorage \"rol\")\r\n        token-almacenado (.getItem js/localStorage \"token\")]\r\n    (when (and usuario-almacenado rol-almacenado token-almacenado)\r\n      (reset! usuario usuario-almacenado)\r\n      (reset! auth-token token-almacenado)\r\n      (reset! logged-in? true)\r\n      (reset! datos-usuario {:nombre usuario-almacenado :rol rol-almacenado})\r\n      true)))\r\n\r\n(defn render-categorias []\r\n  (let [texto (clojure.string/lower-case @categoria-busqueda)\r\n        categorias-filtradas (filter #(clojure.string/includes?\r\n                                       (clojure.string/lower-case (:nombre %))\r\n                                       texto)\r\n                                     @categorias)]\r\n    [:div.col-12\r\n     [:h3 \"Lista de categorias\"]\r\n     ;; Caja de b\u00fasqueda\r\n     [:input.form-control.mb-3\r\n      {:type \"text\"\r\n       :placeholder \"Buscar categor\u00eda por nombre...\"\r\n       :value @categoria-busqueda\r\n       :on-change #(reset! categoria-busqueda (-> % .-target .-value))}]\r\n     [:table {:class \"table table-striped\"}\r\n      [:thead\r\n       [:tr\r\n        [:th {:class \"id\"} \"ID\"] [:th \"Nombre\"] [:th.d-none.d-sm-table-cell \"Descripcion\"] [:th {:class \"tdButton\"} \"Editar\"] [:th {:class \"tdButton\"} \"Eliminar\"]]]\r\n      [:tbody\r\n       (for [{:keys [id nombre descripcion]} categorias-filtradas]\r\n         ^{:key id}\r\n         [:tr\r\n          [:td {:class \"tdButton\"} id] [:td nombre] [:td.d-none.d-sm-table-cell descripcion]\r\n          [:td {:class \"tdButton\"}\r\n           [:button\r\n            {:on-click #(set! (.-hash js/location) (str \"/editar/categoria/\" id))}\r\n            \"Editar\"]]\r\n          [:td {:class \"tdButton\"} [:button\r\n                                    \"Eliminar\"]]])\r\n       [:tr\r\n        [:td [:button {:class \"nuevo\"}\r\n              \"A\u00f1adir nueva categoria\"]]]]]]))\r\n\r\n(defn render-productos []\r\n  (let [texto (clojure.string/lower-case @producto-busqueda)\r\n        productos-filtradas (filter #(clojure.string/includes?\r\n                                      (clojure.string/lower-case (:nombre %))\r\n                                      texto)\r\n                                    @list-productos)]\r\n    [:div.col-12\r\n     [:h3 \"Lista de productos\"]\r\n     [:input.form-control.mb-3\r\n      {:type \"text\"\r\n       :placeholder \"Buscar producto por nombre...\"\r\n       :value @producto-busqueda\r\n       :on-change #(reset! producto-busqueda (-> % .-target .-value))}]\r\n     [:table {:class \"table table-striped\"}\r\n      [:thead\r\n       [:tr\r\n        [:th {:class \"id\"} \"ID\"] [:th \"Nombre\"] [:th.d-none.d-lg-table-cell \"Descripcion\"] [:th.d-none.d-sm-table-cell \"Precio\"]\r\n        [:th.d-none.d-lg-table-cell \"Categor\u00eda\"] [:th.d-none.d-lg-table-cell \"Tipo de plato\"] [:th \"Tipo de porci\u00f3n\"]\r\n        [:th \"Editar\"] [:th \"Eliminar\"]]]\r\n      [:tbody\r\n       (for [{:keys [id nombre description precio nombre_categoria tipo_plato tipo_porcion]} productos-filtradas]\r\n         ^{:key id}\r\n         [:tr\r\n          [:td {:class \"id\"} id] [:td nombre] [:td.d-none.d-lg-table-cell description] [:td.d-none.d-sm-table-cell (str precio \" \u20ac\")]\r\n          [:td.d-none.d-lg-table-cell nombre_categoria] [:td.d-none.d-lg-table-cell tipo_plato] [:td tipo_porcion]\r\n          [:td {:class \"tdButton\"}\r\n           [:button\r\n            {:on-click #(set! (.-hash js/location) (str \"/editar/producto/\" id))}\r\n            \"Editar\"]]\r\n          [:td {:class \"tdButton\"} [:button\r\n                                    \"Eliminar\"]]])\r\n       [:tr\r\n        [:td [:button {:class \"nuevo\"}\r\n              \"A\u00f1adir nuevo producto\"]]]]]]))\r\n\r\n(defn login []\r\n  (POST \"/api/login-admin\"\r\n    {:params {:nombre @usuario\r\n              :contrasenia @contrasenia}\r\n     :format :json\r\n     :response-format :json\r\n     :keywords? true\r\n     :handler #(do\r\n                 (let [{:keys [nombre rol token]} %]\r\n                   ;; Limpia todo antes por si hab\u00eda sesi\u00f3n anterior\r\n                   (.removeItem js/localStorage \"usuario\")\r\n                   (.removeItem js/localStorage \"rol\")\r\n                   (.removeItem js/localStorage \"token\")\r\n                   ;; Guarda los nuevos datos\r\n                   (.setItem js/localStorage \"usuario\" nombre)\r\n                   (.setItem js/localStorage \"rol\" rol)\r\n                   (.setItem js/localStorage \"token\" token)\r\n                   ;; Actualiza los \u00e1tomos de la sesi\u00f3n\r\n                   (reset! auth-token token)\r\n                   (reset! logged-in? true)\r\n                   (reset! datos-usuario {:nombre nombre :rol rol})))\r\n     :error-handler #(do\r\n                       (println \"Error en la solicitud: \" %)\r\n                       (js/alert \"Credenciales incorrectas.\")\r\n                       (reset! loading? false))}))\r\n\r\n(defn login-form []\r\n  [:div.row {:class \"administracion\"}\r\n   [:div {:class \"entrada\"}\r\n    [:div.col-12\r\n     [:p \"Nombre de usuario: \"\r\n      [:input {:type \"text\"\r\n               :placeholder \"Ingrese su nombre de usuario\"\r\n               :value @usuario\r\n               :on-change #(reset! usuario (-> % .-target .-value))}]]\r\n     [:p \"Contrase\u00f1a: \"\r\n      [:input {:type \"password\"\r\n               :placeholder \"Ingrese su contrase\u00f1a\"\r\n               :value @contrasenia\r\n               :on-change #(reset! contrasenia (-> % .-target .-value))}]]]\r\n    [:div.row {:class \"rowButton\"}\r\n     [:div.col-12\r\n      [:button {:on-click login} \"Entrar\"]]]]])\r\n\r\n(defn logout []\r\n  (reset! logged-in? false)\r\n  (reset! auth-token nil)\r\n  (reset! datos-usuario {:nombre nil :rol nil})\r\n  (.removeItem js/localStorage \"usuario\")\r\n  (.removeItem js/localStorage \"token\")\r\n  (.removeItem js/localStorage \"rol\"))\r\n\r\n\r\n(defn admin-panel []\r\n  (fetch-list-productos)\r\n  (fetch-list-categorias)\r\n  [:div.row {:class \"panel\"}\r\n   [:div.col-12 {:class \"panelBotones\"}\r\n    [:h2 (str \"Bienvenido, \" (:nombre @datos-usuario) \"!\")]\r\n    [:p (str \"Tu rol es: \" (:rol @datos-usuario))]\r\n    [:p \"Tienes acceso al panel de administraci\u00f3n.\"]\r\n    [:button {:on-click #(do\r\n                           (logout)\r\n                           (.reload js/location true))}\r\n     \"Cerrar sesi\u00f3n\"]\r\n    (when (= (:rol @datos-usuario) \"admin\")\r\n      [:div {:class \"botonesAdmin\"}\r\n       [:p \"Eres administrador. Puedes editar el contenido.\"]\r\n       [:button {:on-click #(do\r\n                              (reset! mostrar-productos? true)\r\n                              (reset! mostrar-categorias? false)\r\n                              (fetch-list-productos))} \"Mostrar productos\"]\r\n       [:button {:on-click #(do\r\n                              (reset! mostrar-categorias? true)\r\n                              (reset! mostrar-productos? false)\r\n                              (fetch-list-categorias))} \"Mostrar categorias\"]\r\n       [:button {:on-click #(do\r\n                              (reset! mostrar-categorias? true)\r\n                              (reset! mostrar-productos? false)\r\n                              (fetch-list-categorias))} \"Mostrar fotografias\"]])]\r\n   (when @mostrar-productos?\r\n     [render-productos])\r\n   (when @mostrar-categorias?\r\n     [render-categorias])])\r\n\r\n(defn page []\r\n  (if @logged-in?\r\n    [admin-panel]\r\n    [login-form]))\r\n\r\n;; Monta la aplicaci\u00f3n en el DOM\r\n(defn init []\r\n  (revisar-sesion)\r\n  (dom/render [page] (.getElementById js/document \"app\")))\r\n\r\n;; Llamar la funci\u00f3n init para iniciar la aplicaci\u00f3n\r\n(init)\r\n"]}